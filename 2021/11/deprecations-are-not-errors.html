<!doctype html>
<html lang=""><head>
    <meta charset=utf-8>

    <title>Deprecations are not like E_ERROR, E_WARNING, and E_NOTICE ~ Wouter J</title>

    <meta http-equiv=X-UA-Compatible content="IE=edge">
    <meta name=viewport content="width=device-width, initial-scale=1">
    <meta name=theme-color content=#cc3333>

    <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Serif:400,400i,700|Oswald|Inconsolata" rel="stylesheet">
    <link rel=stylesheet href="/assets/main.css?v1">
    <link rel=icon type=image/png href=/img/css/favicon.png sizes=96x96><link type="application/atom+xml" rel="alternate" href="https://wouterj.nl/feed.xml" title="Wouter J" /><meta content="Wouter J" property="og:site_name">
    
      <meta content="Deprecations are not like E_ERROR, E_WARNING, and E_NOTICE" property="og:title">
      <meta content="article" property="og:type">
      <meta content="Every now and then, there seems to be a lot of fuss in the PHP community
about deprecations. In these discussions, deprecations are often
discussed as if they are fatal errors. I think that is very wrong. Let’s
reduce our expectations of deprecations. It’ll make everyones live much
less stressful.

" property="og:description">
      <meta content="2021-11-13T00:00:00+00:00" property="article:published_time">
      <meta content="https://wouterj.nl/2021/11/deprecations-are-not-errors" property="og:url">
      <meta content="https://wouterj.nl/img/og/deprecations-are-not-errors.png?1" property="og:image">
    <script>if(!sessionStorage.getItem("_swa")){fetch("https://counter.dev/track?"+new URLSearchParams({referrer:document.referrer.indexOf(location.protocol+"//"+location.host)!==0?document.referrer:'',screen:screen.width+"x"+screen.height,user:"wouterj",utcoffset:"2"}),{referrerPolicy:"no-referrer-when-downgrade"})};sessionStorage.setItem("_swa","1");</script></head>
<body class="page  page--post" itemscope itemtype="http://schema.org/WebPage"><header class=page__header>
    <hgroup class=page__headline>
        <h1 class="site-title" itemprop="name"><a href="/">Wouter J</a></h1>
    </hgroup><!--<nav class=page__nav>
        <ul class="nav  nav--block"><li class="nav__item  "><a href="/categories/article/index.html"><i class=icon>&#xF139;</i> <span class="button__text">Articles</span></a></li><li class="nav__item  "><a href="/categories/experiment/index.html"><i class=icon>&#xF051;</i> <span class="button__text">Experiments</span></a></li><li class="nav__item  "><a href="/categories/links/index.html"><i class=icon>&#xF10E;</i> <span class="button__text">Links</span></a></li></ul>
    </nav>-->
  </div>
</header>
<div class=page__body itemscope itemtype="http://schema.org/Blog">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    
        <span class="post__category">
        <time class="dt-published" datetime="2021-11-13T00:00:00+00:00" itemprop="datePublished">
            NOV '21
        </time>
        
        
        &#xf139;
        
        </span>
    

    <h1 class="post__heading" itemprop="headline">Deprecations are not like E_ERROR, E_WARNING, and E_NOTICE</h1>

    

    <div itemprop="articleBody">
        <div class="post__entry--excerpt">
            
            <p>Every now and then, there seems to be a lot of fuss in the PHP community
about deprecations. In these discussions, deprecations are often
discussed as if they are fatal errors. I think that is very wrong. Let’s
reduce our expectations of deprecations. It’ll make everyones live much
less stressful.</p></div><div class="post__entry">
      <h2 id="why-we-were-afraid-of-change-in-the-past">
        
        
          <a href="#why-we-were-afraid-of-change-in-the-past" class="section-link"></a> Why we were Afraid of Change in the Past
        
        
      </h2>

<aside class="side" data-type="side note">
  <p>I can’t think of a world without deprecations and backwards
compatibility nowadays. The PHP community has matured fast. The
semantic versioning specification, which I think has ignited the
backwards compatibility movement, was published only 8 years ago
in 2013. In this same year, Symfony triggered its first ever deprecation
notice.</p>
</aside>

<p>In the past, the only way to know about a change in the next version was
by reading the CHANGELOGs. Every change required you to manually check
if your code was affected.</p>

<p>Mind you, even Composer was not a thing 8 years ago. Most applications
would just copy past the vendor code in their project (sometimes even
altering code in the vendor).</p>

<p>This took time, a lot of time. As a consequence, languages and
libraries were very restricted in how they could evolve.</p>
    
      <h2 id="why-php-developers-are-afraid-of-any-e_-being-reported">
        
        
          <a href="#why-php-developers-are-afraid-of-any-e_-being-reported" class="section-link"></a> Why PHP Developers are Afraid of any <code class="highlighter-shiki">E_*</code> being Reported
        
        
      </h2>

<p>PHP had a habit of trying to “fix” incorrect code. Forgot the quotes
around a string? No worries, <a href="https://3v4l.org/m0l3p">PHP still interpreted it as a
string</a> if the constant wasn’t found. It
triggered an <code class="highlighter-shiki">E_NOTICE</code> to let you know that PHP found something
unexpected but tried to continue.</p>

<p>This can produce unexpected behavior (e.g. what if you meant a constant,
but you made a typo?). As a result, PHP developers have become extremely
careful with anything being reported. Even though it’s not a direct fatal
error, many of us correctly consider notices to be something that must
be fixed.</p>

<p>However, this also makes us very careful with <code class="highlighter-shiki">E_DEPRECATED</code>. After all,
it’s reported and it starts with <code class="highlighter-shiki">E_</code>. That MUST be fixed as soon as
possible, right? …right?</p>
    
      <h2 id="why-deprecations-are-different">
        
        
          <a href="#why-deprecations-are-different" class="section-link"></a> Why Deprecations are Different
        
        
      </h2>

<p>Deprecations are not like notices, warnings or errors. Deprecations are
the cornerstone in <em>smooth upgrade paths</em>. This smooth upgrade path
contains a couple steps:</p>

<ol>
  <li>A contributor makes a backwards compatibility breaking change</li>
  <li>The contributor introduces a “BC layer” to make sure the old API
also works. This “BC layer” triggers a deprecation, notifying that
you’re using a legacy API</li>
  <li>In the next major version, a maintainer removes the “BC layer” and
the new API is the only available API</li>
</ol>

<p>This means that a <em>user</em> can use the old API as long as they want, until
they want to upgrade to the next major version.</p>

<aside class="side" data-type="side note">
  <p>The smooth upgrade path is such an improvement that most maintainers
have to get used to it. Most developers love refactoring legacy bits,
and I think it’s normal to “overshoot” it at first. Maintainers will
learn from this (I’m sure the hard upgrade from Symfony 3.4 is not
repeated again).</p>

  <p>Give them constructive feedback on what made an upgrade hard for your
applications. Don’t judge them for making changes, help them improve
further changes.</p>
</aside>

<p>A deprecation is a major help for us <em>users</em>. Instead of being notified
only after the major release (by reading the CHANGELOG), we get notified
years or months in advance. For instance, you have at least 3 years to
fix any deprecation that Symfony gives you.</p>
    
      <h2 id="you-dont-have-to-run-deprecation-free">
        
        
          <a href="#you-dont-have-to-run-deprecation-free" class="section-link"></a> You don’t have to run Deprecation-free
        
        
      </h2>

<p>Using a deprecated feature doesn’t result in unpredictable behavior,
like PHP’s notices do. They don’t signal a bug, like warnings and errors
do. They just tell you that you have some work to do before upgrading to
the next major version. That’s all!</p>

<p>With deprecations, you can prioritize upgrade work and reserve some time
for it in a 2 or 3 year timespan. Backwards compatibility breaks are no
longer ad-hoc tasks, they become plannable tasks.</p>

<p>Is your business busy the next few months? Fine! Your apps remain
running with tons of deprecations for months to come. There will always
be a boring week in the summer break were you can fix a couple
deprecations.</p>

<p>Most often, when a new deprecation is introduced, the major version is not
even being worked on. For instance, if PHP triggers a deprecation now,
you’re notified of a breaking change in PHP 9. Do you know the release
date of PHP 9? I don’t (probably one or two years from now?). Is it
really worth worrying so much today about a breaking change in an
unknown future?</p>
    
      <h2 id="dont-judge-your-vendor-code-for-not-running-deprecation-free">
        
        
          <a href="#dont-judge-your-vendor-code-for-not-running-deprecation-free" class="section-link"></a> Don’t Judge your Vendor Code for not running Deprecation-free
        
        
      </h2>

<p>The same applies to any vendor code that your app is using. Getting
deprecation notices from a vendor library? That’s fine. You can reserve
some time and contribute a fix for one or two deprecations to the open
source project.</p>

<p>If we all do it, the open source project will support the new major
version months before it’s even released.</p>
    
      <h2 id="how-to-hide-and-log-deprecations">
        
        
          <a href="#how-to-hide-and-log-deprecations" class="section-link"></a> How to Hide and Log Deprecations
        
        
      </h2>

<p>If you are using the default PHP error handler, you’re left to either
hide deprecations or output them like all other errors. Symfony has a
small <a href="https://github.com/symfony/error-handler"><code class="highlighter-shiki">symfony/error-handler</code></a>
package that allows you to register <a href="https://php-fig.org/psr/psr-3/">PSR-3 loggers</a>
for a specific error level. Besides, it automatically hides
deprecations from the normal output.</p>

<p>Using this code, all deprecations are logged to <code class="highlighter-shiki">deprecation.log</code> and
the normal error handler is used for all other errors:</p>

<div class="language-php highlighter-shiki"><pre class="shiki-gutter">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><pre class="shiki-code"><code><span class="line" data-linenr="1"><span style="color: #E5673D">&lt;?</span><span style="color: #BBBBBB">php</span></span>
<span class="line" data-linenr="2"></span>
<span class="line" data-linenr="3"><span style="color: #E5673D">require_once</span><span style="color: #BBBBBB"> </span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">vendor/autoload.php</span><span style="color: #999999">&#39;</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="4"></span>
<span class="line" data-linenr="5"><span style="color: #E5673D">use</span><span style="color: #BBBBBB"> Psr</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Log</span><span style="color: #999999">\</span><span style="color: #C7C8D2">AbstractLogger</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="6"><span style="color: #E5673D">use</span><span style="color: #BBBBBB"> Symfony</span><span style="color: #999999">\</span><span style="color: #BBBBBB">Component</span><span style="color: #999999">\</span><span style="color: #BBBBBB">ErrorHandler</span><span style="color: #999999">\</span><span style="color: #C7C8D2">ErrorHandler</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="7"></span>
<span class="line" data-linenr="8"><span style="color: #C7C8D2">ErrorHandler</span><span style="color: #E5673D">::</span><span style="color: #C7C8D2">register</span><span style="color: #999999">()</span></span>
<span class="line" data-linenr="9"><span style="color: #BBBBBB">    </span><span style="color: #E5673D">-&gt;</span><span style="color: #C7C8D2">setDefaultLogger</span><span style="color: #999999">(</span><span style="color: #E5673D">new</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">class</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">extends</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">AbstractLogger</span><span style="color: #BBBBBB"> </span><span style="color: #999999">{</span></span>
<span class="line" data-linenr="10"><span style="color: #BBBBBB">        </span><span style="color: #E5673D">public</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">function</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">log</span><span style="color: #999999">(</span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">level</span><span style="color: #999999">,</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">string</span><span style="color: #999999">|\</span><span style="color: #C7C8D2">Stringable</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">message</span><span style="color: #999999">,</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">array</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">context</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">=</span><span style="color: #BBBBBB"> </span><span style="color: #999999">[])</span><span style="color: #E5673D">:</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">void</span></span>
<span class="line" data-linenr="11"><span style="color: #BBBBBB">        </span><span style="color: #999999">{</span></span>
<span class="line" data-linenr="12"><span style="color: #BBBBBB">            </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">formattedLogLine</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">=</span><span style="color: #BBBBBB"> </span><span style="color: #C7C8D2">sprintf</span><span style="color: #999999">(</span></span>
<span class="line" data-linenr="13"><span style="color: #C7C8D2">                </span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">[%s] %s: %s%s</span><span style="color: #999999">&#39;</span><span style="color: #E5673D">.</span><span style="color: #E5673D">PHP_EOL</span><span style="color: #999999">,</span></span>
<span class="line" data-linenr="14"><span style="color: #C7C8D2">                date</span><span style="color: #999999">(</span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">Y-m-dTH:i:s.uP</span><span style="color: #999999">&#39;</span><span style="color: #999999">),</span></span>
<span class="line" data-linenr="15"><span style="color: #C7C8D2">                </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">level</span><span style="color: #999999">,</span></span>
<span class="line" data-linenr="16"><span style="color: #C7C8D2">                </span><span style="color: #999999">(</span><span style="color: #E5673D">string</span><span style="color: #999999">)</span><span style="color: #C7C8D2"> </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">message</span><span style="color: #999999">,</span></span>
<span class="line" data-linenr="17"><span style="color: #C7C8D2">                </span><span style="color: #999999">(</span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">context</span><span style="color: #999999">[</span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">exception</span><span style="color: #999999">&#39;</span><span style="color: #999999">]</span><span style="color: #C7C8D2"> </span><span style="color: #E5673D">??</span><span style="color: #C7C8D2"> </span><span style="color: #E5673D">false</span><span style="color: #999999">)</span><span style="color: #C7C8D2"> </span><span style="color: #E5673D">instanceof</span><span style="color: #C7C8D2"> </span><span style="color: #999999">\</span><span style="color: #C7C8D2">Throwable</span></span>
<span class="line" data-linenr="18"><span style="color: #C7C8D2">                    </span><span style="color: #E5673D">?</span><span style="color: #C7C8D2"> </span><span style="color: #C7C8D2">sprintf</span><span style="color: #999999">(</span><span style="color: #999999">&#39;</span><span style="color: #7CC64A"> in %s:%s</span><span style="color: #999999">&#39;</span><span style="color: #999999">,</span><span style="color: #C7C8D2"> </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">context</span><span style="color: #999999">[</span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">exception</span><span style="color: #999999">&#39;</span><span style="color: #999999">]</span><span style="color: #E5673D">-&gt;</span><span style="color: #C7C8D2">getFile</span><span style="color: #999999">(),</span><span style="color: #C7C8D2"> </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">context</span><span style="color: #999999">[</span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">exception</span><span style="color: #999999">&#39;</span><span style="color: #999999">]</span><span style="color: #E5673D">-&gt;</span><span style="color: #C7C8D2">getLine</span><span style="color: #999999">())</span></span>
<span class="line" data-linenr="19"><span style="color: #C7C8D2">                    </span><span style="color: #E5673D">:</span><span style="color: #C7C8D2"> </span><span style="color: #999999">&#39;&#39;</span></span>
<span class="line" data-linenr="20"><span style="color: #C7C8D2">            </span><span style="color: #999999">)</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="21"></span>
<span class="line" data-linenr="22"><span style="color: #BBBBBB">            </span><span style="color: #C7C8D2">file_put_contents</span><span style="color: #999999">(</span><span style="color: #E5673D">__DIR__</span><span style="color: #E5673D">.</span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">/deprecations.log</span><span style="color: #999999">&#39;</span><span style="color: #999999">,</span><span style="color: #C7C8D2"> </span><span style="color: #E5673D">$</span><span style="color: #D8DEE9">formattedLogLine</span><span style="color: #999999">,</span><span style="color: #C7C8D2"> </span><span style="color: #999999">\</span><span style="color: #E5673D">FILE_APPEND</span><span style="color: #999999">)</span><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="23"><span style="color: #BBBBBB">        </span><span style="color: #999999">}</span></span>
<span class="line" data-linenr="24"><span style="color: #BBBBBB">    </span><span style="color: #999999">},</span><span style="color: #BBBBBB"> </span><span style="color: #999999">\</span><span style="color: #E5673D">E_DEPRECATED</span><span style="color: #BBBBBB"> </span><span style="color: #E5673D">|</span><span style="color: #BBBBBB"> </span><span style="color: #999999">\</span><span style="color: #E5673D">E_USER_DEPRECATED</span><span style="color: #999999">)</span></span>
<span class="line" data-linenr="25"><span style="color: #E5673D">;</span></span>
<span class="line" data-linenr="26"></span>
<span class="line" data-linenr="27"><span style="color: #6B90C0; font-style: italic">// &quot;null&quot; argument deprecated as of PHP 8.1</span></span>
<span class="line" data-linenr="28"><span style="color: #C7C8D2">var_dump</span><span style="color: #999999">(</span><span style="color: #C7C8D2">str_contains</span><span style="color: #999999">(</span><span style="color: #999999">&#39;</span><span style="color: #7CC64A">foo</span><span style="color: #999999">&#39;</span><span style="color: #999999">,</span><span style="color: #C7C8D2"> </span><span style="color: #E5673D">null</span><span style="color: #999999">))</span><span style="color: #E5673D">;</span></span></code></pre>
</div>
    
      <h2 id="take-homes">
        
        
          <a href="#take-homes" class="section-link"></a> Take Home’s
        
        
      </h2>

<ul>
  <li>Don’t try to run deprecation free until you want to upgrade to a new
major</li>
  <li>Don’t judge maintainers triggering deprecations, thank them for
letting you know about a big change way in advance</li>
  <li>Deprecations make upgrade tasks plannable, instead of ad-hoc</li>
</ul>

        </div>
    </div>
</article>

    </main><footer class="page__footer">
    <p>&copy; Copyright 2012 - 2022 Wouter de Jong</p>
</footer>
</body>

</html>
